<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Distributed Tracing | Node.JS Reference Architecture</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://nodeshift.dev/nodejs-reference-architecture/operations/distributed-tracing"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Distributed Tracing | Node.JS Reference Architecture"><meta data-react-helmet="true" name="description" content="Recommended Components"><meta data-react-helmet="true" property="og:description" content="Recommended Components"><link data-react-helmet="true" rel="shortcut icon" href="/nodejs-reference-architecture/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://nodeshift.dev/nodejs-reference-architecture/operations/distributed-tracing"><link data-react-helmet="true" rel="alternate" href="https://nodeshift.dev/nodejs-reference-architecture/operations/distributed-tracing" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://nodeshift.dev/nodejs-reference-architecture/operations/distributed-tracing" hreflang="x-default"><link rel="stylesheet" href="/nodejs-reference-architecture/assets/css/styles.28552db3.css">
<link rel="preload" href="/nodejs-reference-architecture/assets/js/runtime~main.27a4d17c.js" as="script">
<link rel="preload" href="/nodejs-reference-architecture/assets/js/main.e079b801.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/nodejs-reference-architecture/"></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/nodejs-reference-architecture/">Node.js Reference Architecture</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Development</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Functional components</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Operations</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/nodejs-reference-architecture/operations/distributed-tracing">Distributed Tracing</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/operations/failurehandling">Fault Tolerance</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/operations/healthchecks">Health Checks</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/operations/logging">Logging</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/operations/metrics">Metrics</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Distributed Tracing</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="recommended-components"></a>Recommended Components<a class="hash-link" href="#recommended-components" title="Direct link to heading">#</a></h2><p>Distributed tracing typically requires a mechanism for collecting traces (instrumentation)
and a separate mechanism for reporting and visualizing those traces.</p><ul><li><a href="https://opentelemetry.io/" target="_blank" rel="noopener noreferrer">OpenTelemetry</a> provides instrumentation in multiple languages
including Node. OpenTelemetry is not yet released as a final stable version and is in Beta.
OpenTelemetry replaces both OpenTracing and OpenCensus, neither of which are actively being
developed (security fixes only).</li></ul><p>For adding instrumentation to Node applications and services:</p><ul><li><a href="https://www.npmjs.com/package/@opentelemetry/node" target="_blank" rel="noopener noreferrer">@opentelemetry/node</a> - See the
<a href="https://github.com/open-telemetry/opentelemetry-js/blob/master/getting-started/README.md" target="_blank" rel="noopener noreferrer">Getting Started Guide</a></li></ul><p>Reasons for choosing OpenTelemetry:</p><ul><li>the open source tracing library that&#x27;s replacing both OpenCensus and OpenTracing</li><li>handles basic use cases really well, includes good default configuration for most use cases</li><li>includes support for newer efficient Node implementation for correlating outbound traffic
to incoming requests</li><li>supports multiple languages for tracing (not just Node) with a consistent API.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="guidance"></a>Guidance<a class="hash-link" href="#guidance" title="Direct link to heading">#</a></h2><p>There is significant value in collecting distributed tracing as it:</p><ul><li>allows easy identification of performance critical services and code</li><li>allows quick navigation to failing calls that are &quot;buried&quot; deep in the system</li><li>allows a clearer understanding of the interdependencies of complicated systems</li></ul><p>These benefits come at a cost in:</p><ul><li>adding instrumentation to each application and the related negligible application overhead</li><li>significant additional network and storage utilization</li><li>additional services, and the related administration (Jaeger/ElasticSearch, etc.)</li></ul><p>For non-trivial systems the benefits are typically worth the costs, especially when investigating
problems.</p><p>OpenTelemetry allows the ability to sample a subset of traces to reduce the storage and network
utilization of the tracing data. The guidance here is that, where possible, sampling should be disabled
such that all traces are recorded. If sampling is enabled, it is inevitable that the trace data is
missing when trying to investigate some critical failure.</p><p>Be aware that:</p><ul><li>some error conditions that do not trigger network traffic are not traced (e.g. DNS lookup
failures, etc.)</li><li>existing instrumentation libraries are not customizable (no hooks, or extension points -
not able to extend instrumentation to add additional data without reimplementing them)</li><li>you are not able to post process traces from instrumentation prior to exporting them</li><li>you are not able to easily change configuration options dynamically (enabling/disabling tracing)</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="infrastructure"></a>Infrastructure<a class="hash-link" href="#infrastructure" title="Direct link to heading">#</a></h3><ul><li><a href="https://www.jaegertracing.io/" target="_blank" rel="noopener noreferrer">Jaeger</a> provides visualization of distributed traces.</li><li><a href="https://www.elastic.co/elastic-stack" target="_blank" rel="noopener noreferrer">ElasticSearch &amp; Kibana</a> provides storage for persisting
the data behind Jaeger as well as alternate mechanisms in Kibana to search, visualize, and manage
that data.</li><li>An alternate for Jaeger is <a href="https://zipkin.io/" target="_blank" rel="noopener noreferrer">Zipkin</a> which is also directly supported by
OpenTelemetry for visualizing distributed traces. The instrumentation in Node is not impacted
by the selection of the visualization tool. Both Jaeger and Zipkin can be used concurrently if
storage space is available. If using Zipkin, <a href="https://cassandra.apache.org/" target="_blank" rel="noopener noreferrer">Cassandra</a> may be used
instead of ElasticSearch.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="integration-suggestions"></a>Integration suggestions<a class="hash-link" href="#integration-suggestions" title="Direct link to heading">#</a></h3><p>Data management becomes a critical aspect of distributed tracing. Consider:</p><ul><li>expiring data as it ages out and is no longer relevant</li><li>volumes and network traffic can become excessive</li><li>storage costs can be large.</li></ul><p>OpenTelemetry by default installs instrumentation patches for many communication protocols
(HTTP, HTTPS, GPRC, etc.). Configure OpenTelemetry to install just those patches for protocols that are
actively used in your applications.</p><p>OpenTelemetry can be installed in container-based systems like Kubernetes. When used in conjunction with
Istio care needs to be taken to ensure that either:</p><ul><li>Istio distributed tracing is disabled</li><li>Istio distributed tracing is enabled and also exports all trace data to the same systems as OpenTelemetry.
Additionally, since Istio is typically the entry point for new connections, it is what sets the
sampling conditions for traces, and not OpenTelemetry. Ensure sampling in Istio is correctly configured.
If Istio distributed tracing is enabled, but not exported to the same systems as OpenTelemetry, it
will cause gaps and orphans in the tracing hierarchies.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/nodeshift/nodejs-reference-architecture/docs/operations/distributed-tracing.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/nodejs-reference-architecture/functional-components/webframework"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Web Framework</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/nodejs-reference-architecture/operations/failurehandling"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Fault Tolerance Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#recommended-components" class="table-of-contents__link">Recommended Components</a></li><li><a href="#guidance" class="table-of-contents__link">Guidance</a><ul><li><a href="#infrastructure" class="table-of-contents__link">Infrastructure</a></li><li><a href="#integration-suggestions" class="table-of-contents__link">Integration suggestions</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/nodejs-reference-architecture/assets/js/runtime~main.27a4d17c.js"></script>
<script src="/nodejs-reference-architecture/assets/js/main.e079b801.js"></script>
</body>
</html>