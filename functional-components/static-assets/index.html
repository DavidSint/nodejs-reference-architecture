<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Static assets | Node.JS Reference Architecture</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://nodeshift.dev/nodejs-reference-architecture/functional-components/static-assets"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Static assets | Node.JS Reference Architecture"><meta data-react-helmet="true" name="description" content="Strategies"><meta data-react-helmet="true" property="og:description" content="Strategies"><link data-react-helmet="true" rel="shortcut icon" href="/nodejs-reference-architecture/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://nodeshift.dev/nodejs-reference-architecture/functional-components/static-assets"><link data-react-helmet="true" rel="alternate" href="https://nodeshift.dev/nodejs-reference-architecture/functional-components/static-assets" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://nodeshift.dev/nodejs-reference-architecture/functional-components/static-assets" hreflang="x-default"><link rel="stylesheet" href="/nodejs-reference-architecture/assets/css/styles.28552db3.css">
<link rel="preload" href="/nodejs-reference-architecture/assets/js/runtime~main.868cc01c.js" as="script">
<link rel="preload" href="/nodejs-reference-architecture/assets/js/main.59eed041.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/nodejs-reference-architecture/"></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/nodejs-reference-architecture/">Node.js Reference Architecture</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Development</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Functional components</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/auth">Authentication</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/data-caching">Data Caching</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/databases">Databases</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/graphql">GraphQL Development</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/internationalization">Internationalization</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/message-queuing">Message Queuing</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/nodejs-versions-images">Node.js Versions and Container Images</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/scaling-multi-threading">Scaling and Multi-threading</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/nodejs-reference-architecture/functional-components/static-assets">Static assets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/template-engines">Template Engines (Server Side)</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/webframework">Web Framework</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Operations</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Static assets</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="strategies"></a>Strategies<a class="hash-link" href="#strategies" title="Direct link to heading">#</a></h2><p>There are different strategies when dealing with assets/resources in a Node.js application:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="static-only-content"></a>Static only content<a class="hash-link" href="#static-only-content" title="Direct link to heading">#</a></h3><p>If your application has only client JavaScript, like a Single Page Application (SPA), look no further. You most likely do not need to use Node.js to host the static content. You can use web servers or object storage like <code>nginx</code>, <code>Apache</code>, <code>COS</code>, <code>S3</code>, etc, and front that system with caching (CDN).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="application-with-dynamically-growing-content-user-generated-content"></a>Application with dynamically growing content (user generated content)<a class="hash-link" href="#application-with-dynamically-growing-content-user-generated-content" title="Direct link to heading">#</a></h3><p>If your application has primarily server logic, but with growing content, consider using Node.js in combination with an external storage system like <code>COS</code> or <code>S3</code>. For example, if you have a Node.js application for uploading images, instead of saving images to the file system, consider saving images to object storage. This is a more scalable approach compared to saving images on the file system, which can grow beyond the infrastructure.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="application-with-frontend"></a>Application with frontend<a class="hash-link" href="#application-with-frontend" title="Direct link to heading">#</a></h3><p>If your application has client and server logic, then you should consider using Node.js web server (express) with static middleware. It is a best practice to couple your frontend and backend together as a single, deployable artifact. Doing so addresses concerns such as:</p><ul><li>Syncing assets to external environments (CDNs, object storage, etc)</li><li>Deploying artifact to different environments (because the assets are self contained, no issues with syncing)</li><li>Able to use same domain for HTTP2</li></ul><p>Read futher for additional guidance on using cache-control headers for static assets.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="recommended-packages"></a>Recommended packages<a class="hash-link" href="#recommended-packages" title="Direct link to heading">#</a></h2><ul><li><a href="https://expressjs.com/en/4x/api.html#express.static" target="_blank" rel="noopener noreferrer">express.static</a>: <code>express.static</code> is part of the Express.js package that allows developers to expose static middlewares.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="guidance"></a>Guidance<a class="hash-link" href="#guidance" title="Direct link to heading">#</a></h2><p>For serving static resources on the application, we recommend using <a href="https://expressjs.com/en/4x/api.html#express.static" target="_blank" rel="noopener noreferrer">express.static</a> middleware as it has been widely used and tested in production.</p><p>When using <code>express.static()</code> method, we can serve static resources directly by specifying the folder name where we have stored our static resources.</p><p>Documentation for the middleware can be found <a href="https://expressjs.com/en/4x/api.html#express.static" target="_blank" rel="noopener noreferrer">here</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="caching"></a>Caching<a class="hash-link" href="#caching" title="Direct link to heading">#</a></h3><p>The static middleware allows caching of static resources via exposed <a href="https://www.freecodecamp.org/news/an-in-depth-introduction-to-http-caching-cache-control-vary/" target="_blank" rel="noopener noreferrer">caching-headers</a>.</p><p>Origin servers communicate caching instructions via the header <code>Cache-Control</code>. The values of <code>Cache-Control</code> are called directives. Example directives include: <code>max-age</code>, <code>no-store, no-cache, must-revalidate</code>, <code>public, private</code>, etc.</p><p>Freshness control of the resource happens in cache and is based on time. The validation that happens on origin server is based on time and identifiers (ETags). It is important to have ETag header on all HTTP resources (better/stronger than time based header).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="common-directive-use-cases"></a>Common Directive Use Cases<a class="hash-link" href="#common-directive-use-cases" title="Direct link to heading">#</a></h4><p>Note: Upstream systems can be picky about interpreting directives for caching. You may have to read documentation for the particular system (Akamai, Fastly, Google CDN, Cloudflare, nginx, varnish) to verify valid directives.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="caching-static-assets-for-a-year"></a>Caching static assets for a year<a class="hash-link" href="#caching-static-assets-for-a-year" title="Direct link to heading">#</a></h5><p>Cache static assets for a year if the filename and contents are uniquely generated</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Cache-Control: public, max-age=31536000</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If <code>Cache-Control</code> does not have max-age, it will respect Expires header</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Cache-Control: public</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Expires: Sat, 13 Feb 2022 07:00:00 GMT</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="caching-http-resources-only-on-browser"></a>Caching HTTP resources only on browser<a class="hash-link" href="#caching-http-resources-only-on-browser" title="Direct link to heading">#</a></h5><p>In some cases, we want to force cache only for the browser and not for CDN or other upstream caches.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Cache-Control: private</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="no-caching-allowed"></a>No caching allowed<a class="hash-link" href="#no-caching-allowed" title="Direct link to heading">#</a></h5><p>Force upstream to not cache at all. Useful if you need to ensure that an HTTP resource always goes to origin (for example, if the HTTP resource varies due to a cookie and the endpoint is common to all users)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Cache-Control: no-store, no-cache, must-revalidate</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="advanced-caching-guidance"></a>Advanced Caching Guidance<a class="hash-link" href="#advanced-caching-guidance" title="Direct link to heading">#</a></h4><p>For more advanced use cases, caching can be controlled independently of the <code>Cache-Control</code> headers. Depending on upstream caching system, you can configure <code>Cache-Control</code> header from origin to the CDN, and configure a separate set of caching rules for downstream (the browsers).</p><p>Say for example your application contains pages/resources that change depending on a user&#x27;s logged in state. It is important that <code>Cache-Control</code> is not cached on the browser, however we can still cache at the edge and control the &quot;cache key&quot; based on unique identifiers (such as a userId).</p><p>This ensures less hits to origin, takes advantage of caching at the edge, and removes the potential for bad user experiences due to aggressively cached pages.</p><p>If the application contains uniquely different pages/resources from a non-logged in user, you could keep <code>Cache-Control</code> with <code>private, max-age=300</code> (or max-age as appropriate based on content and session expiration).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="naming-static-assets"></a>Naming Static Assets<a class="hash-link" href="#naming-static-assets" title="Direct link to heading">#</a></h3><p>If you configured your static middleware to use client side caching please make sure that
every modification in your code will be creating resources with different filename.</p><p>When using bundlers you will explicitly need to generate different filenames every time content changes. If hash is used in filename, caching directives can be set as long as a year.</p><p>Example for webpack (most popular bundler) can be found <a href="https://webpack.js.org/guides/caching" target="_blank" rel="noopener noreferrer">here</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/nodeshift/nodejs-reference-architecture/docs/functional-components/static-assets.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/nodejs-reference-architecture/functional-components/scaling-multi-threading"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Scaling and Multi-threading</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/nodejs-reference-architecture/functional-components/template-engines"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Template Engines (Server Side) Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#strategies" class="table-of-contents__link">Strategies</a><ul><li><a href="#static-only-content" class="table-of-contents__link">Static only content</a></li><li><a href="#application-with-dynamically-growing-content-user-generated-content" class="table-of-contents__link">Application with dynamically growing content (user generated content)</a></li><li><a href="#application-with-frontend" class="table-of-contents__link">Application with frontend</a></li></ul></li><li><a href="#recommended-packages" class="table-of-contents__link">Recommended packages</a></li><li><a href="#guidance" class="table-of-contents__link">Guidance</a><ul><li><a href="#caching" class="table-of-contents__link">Caching</a></li><li><a href="#naming-static-assets" class="table-of-contents__link">Naming Static Assets</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/nodejs-reference-architecture/assets/js/runtime~main.868cc01c.js"></script>
<script src="/nodejs-reference-architecture/assets/js/main.59eed041.js"></script>
</body>
</html>