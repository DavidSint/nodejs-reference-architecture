<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Scaling and Multi-threading | Node.JS Reference Architecture</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://nodeshift.dev/nodejs-reference-architecture/docs/functional-components/scaling-multi-threading"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Scaling and Multi-threading | Node.JS Reference Architecture"><meta data-react-helmet="true" name="description" content="Node.js is said to be single-threaded. While not quite true, it reflects that"><meta data-react-helmet="true" property="og:description" content="Node.js is said to be single-threaded. While not quite true, it reflects that"><link data-react-helmet="true" rel="shortcut icon" href="/nodejs-reference-architecture/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://nodeshift.dev/nodejs-reference-architecture/docs/functional-components/scaling-multi-threading"><link data-react-helmet="true" rel="alternate" href="https://nodeshift.dev/nodejs-reference-architecture/docs/functional-components/scaling-multi-threading" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://nodeshift.dev/nodejs-reference-architecture/docs/functional-components/scaling-multi-threading" hreflang="x-default"><link rel="stylesheet" href="/nodejs-reference-architecture/assets/css/styles.c2e2bee9.css">
<link rel="preload" href="/nodejs-reference-architecture/assets/js/runtime~main.4c419f35.js" as="script">
<link rel="preload" href="/nodejs-reference-architecture/assets/js/main.cecdbc64.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/nodejs-reference-architecture/"></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/nodejs-reference-architecture/">Node.js Reference Architecture</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Development</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/development/building-good-containers">Building Good Containers</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/development/code-consistency">Code Consistency</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/development/npm-proxy">Npm Proxy / Internal Registry</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/development/npm-publishing">Npm Publishing Guidelines</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/development/testing">Testing</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/development/apifirst">API First</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/development/typescript">Typescript</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Functional components</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/auth">Authentication</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/data-caching">Data Caching</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/databases">Databases</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/graphql">GraphQL Development</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/internationalization">Internationalization</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/message-queuing">Message Queuing</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/nodejs-versions-images">Node.js Versions and Container Images</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/scaling-multi-threading">Scaling and Multi-threading</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/static-assets">Static assets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/template-engines">Template Engines (Server Side)</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/functional-components/webframework">Web Framework</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Operations</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/operations/distributed-tracing">Distributed Tracing</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/operations/failurehandling">Fault Tolerance</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/operations/healthchecks">Health Checks</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/operations/logging">Logging</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/operations/metrics">Metrics</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">docs</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/">Node.js Reference Architecture</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Development</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/development/building-good-containers">Building Good Containers</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/development/code-consistency">Code Consistency</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/development/npm-proxy">Npm Proxy / Internal Registry</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/development/npm-publishing">Npm Publishing Guidelines</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/development/testing">Testing</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/development/typescript">Typescript</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/development/code-coverage">Code Coverage</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Functional components</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/functional-components/apifirst">REST APIs Development</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/functional-components/auth">Authentication</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/functional-components/data-caching">Data Caching</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/functional-components/databases">Databases</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/functional-components/graphql">GraphQL Development</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/functional-components/internationalization">Internationalization</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/functional-components/message-queuing">Message Queuing</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/functional-components/nodejs-versions-images">Node.js Versions and Container Images</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/nodejs-reference-architecture/docs/functional-components/scaling-multi-threading">Scaling and Multi-threading</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/functional-components/static-assets">Static assets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/functional-components/template-engines">Template Engines (Server Side)</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/functional-components/webframework">Web Framework</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Operations</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/operations/distributed-tracing">Distributed Tracing</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/operations/failurehandling">Fault Tolerance</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/operations/healthchecks">Health Checks</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/operations/logging">Logging</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/docs/operations/metrics">Metrics</a></li></ul></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Scaling and Multi-threading</h1></header><p>Node.js is said to be <code>single-threaded</code>. While not quite true, it reflects that
most work is done on a single thread running the event loop. The asynchronous
nature of JavaScript means that Node.js can handle a larger number of
concurrent requests on that single thread.</p><p>At the same time that does not mean that Node.js applications/solutions are
<code>single-threaded</code>. Today&#x27;s computers provide multiple concurrent threads of
execution (either with multiple cores and/or cores that can support
multiple concurrent threads of execution) and Node.js applications have
long exploited those additional threads by running multiple Node.js instances.</p><p>Mutiple threads within a single machine can typically either be exploited within
a single process or by starting multiple processes. There are advantages
and dis-advantages to each.</p><p>Processes provide better isolation but also lower
opportunities to share resources and makes communication between threads
more costly. While using multiple threads within a process may be able to
scale more efficiently within a single process it has the hard limit
of only being able to scale to the resources provided by a single machine.</p><p>With container based deployments the number of threads available may
also be limited, with the assumption that when additional cpu resources
are needed, additional containers will be created and the load
spread across those containers.</p><p>Today&#x27;s cloud native deployments generally have a goal to be able to
scale to a level that that cannot be met through by the
resources/availability that can be achieved on a single machine. This
naturally favors scaling by adding additional copies of a container,
each of which, is typically running a single process.</p><p>The small footprint and fast startup of Node.js, along with the
ability to handle many concurrent requests without needing multiple
threads of execution and synchornization between those threads makes
it a good fit for todays approach to scaling using containers.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="recommended-components"></a>Recommended Components<a class="hash-link" href="#recommended-components" title="Direct link to heading">#</a></h2><p>We don&#x27;t recommened any specific components at this time.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="guidance"></a>Guidance<a class="hash-link" href="#guidance" title="Direct link to heading">#</a></h2><ul><li><p>when possible applications should be decomposed so that a
request to a single container will need no more than single
thread of execution in order to complete in a reasonable time.
When necessary to achive this, consider futher decomposing
the application. If this is not reasonable,
<a href="https://nodejs.org/api/worker_threads.html" target="_blank" rel="noopener noreferrer">WorkerThreads</a>
are recommended versus multiple processes in the same container.</p></li><li><p>delegate management of the containers supporting
the application and the routing of requests to those containers
to the highest layer possible. For example, if the application
is deployed to kubernetes, do not use tools like the
<a href="https://nodejs.org/api/cluster.html" target="_blank" rel="noopener noreferrer">Cluster API</a> to manage
requests within a container, instead rely on the facilities
provided by kubernetes. In our experience this has been
just as efficient in terms of machine resources and allows
better scaling.</p><ul><li>Avoid blocking the event loop for a prolonged period
of time. If you have a mix of request types where some are long
running, consider moving the long running requests so that they
execute in their own set of containers in order to enable better
scaling. However, even once moved it often makes sense to use
<a href="https://nodejs.org/api/worker_threads.html" target="_blank" rel="noopener noreferrer">WorkerThreads</a> to
run the long running request in order to
avoid blocking the main event loop. This is to prevent
long running requests on the main event loop from stalling
requests to health monitoring, metrics and similar endpoints
that need to be supported by a containter.</li></ul></li><li><p>When using <a href="https://nodejs.org/api/worker_threads.html" target="_blank" rel="noopener noreferrer">WorkerThreads</a>
make sure you pool worker threads (for example
by using something like <a href="https://www.npmjs.com/package/piscina" target="_blank" rel="noopener noreferrer">piscina</a>
and ensure you preserve ascync context for requests with
<a href="https://nodejs.org/api/async_hooks.html#async_hooks_class_asyncresource" target="_blank" rel="noopener noreferrer">AsyncResource</a>
if you don&#x27;t use an existing pooling library like piscina which
does this for you.</p></li><li><p><a href="https://nodejs.org/api/worker_threads.html" target="_blank" rel="noopener noreferrer">WorkerThreads</a>
may also be appropriate if your application
must run as a single process (for example a desktop application). In these
cases it is known that you cannot scale beyond the resources of the single
machine and it is often preferrable to have the application show up
as a single processes versus many individual processes.</p></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/nodeshift/nodejs-reference-architecture/docs/docs/functional-components/scaling-multi-threading.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/nodejs-reference-architecture/docs/functional-components/nodejs-versions-images"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Node.js Versions and Container Images</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/nodejs-reference-architecture/docs/functional-components/static-assets"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Static assets Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#recommended-components" class="table-of-contents__link">Recommended Components</a></li><li><a href="#guidance" class="table-of-contents__link">Guidance</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/nodejs-reference-architecture/assets/js/runtime~main.4c419f35.js"></script>
<script src="/nodejs-reference-architecture/assets/js/main.cecdbc64.js"></script>
</body>
</html>