<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Npm Publishing Guidelines | Node.JS Reference Architecture</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://nodeshift.dev/nodejs-reference-architecture/development/npm-publishing"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Npm Publishing Guidelines | Node.JS Reference Architecture"><meta data-react-helmet="true" name="description" content="Guidance"><meta data-react-helmet="true" property="og:description" content="Guidance"><link data-react-helmet="true" rel="shortcut icon" href="/nodejs-reference-architecture/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://nodeshift.dev/nodejs-reference-architecture/development/npm-publishing"><link data-react-helmet="true" rel="alternate" href="https://nodeshift.dev/nodejs-reference-architecture/development/npm-publishing" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://nodeshift.dev/nodejs-reference-architecture/development/npm-publishing" hreflang="x-default"><link rel="stylesheet" href="/nodejs-reference-architecture/assets/css/styles.28552db3.css">
<link rel="preload" href="/nodejs-reference-architecture/assets/js/runtime~main.27a4d17c.js" as="script">
<link rel="preload" href="/nodejs-reference-architecture/assets/js/main.3a4e6bc3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/nodejs-reference-architecture/"></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/nodejs-reference-architecture/">Node.js Reference Architecture</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Development</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/development/building-good-containers">Building Good Containers</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/development/code-consistency">Code Consistency</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/development/npm-proxy">Npm Proxy / Internal Registry</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/nodejs-reference-architecture/development/npm-publishing">Npm Publishing Guidelines</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/nodejs-reference-architecture/development/testing">Testing</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Functional components</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Operations</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Npm Publishing Guidelines</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="guidance"></a>Guidance<a class="hash-link" href="#guidance" title="Direct link to heading">#</a></h2><p>When publishing modules to npm, it is recommened to enable 2 factor authenticaton. How to set that up can be found here <a href="https://docs.npmjs.com/configuring-two-factor-authentication" target="_blank" rel="noopener noreferrer">https://docs.npmjs.com/configuring-two-factor-authentication</a>. It is also a good practice to require the use of two-factor authentication or automation tokens for each module that is published.</p><p>If the module will be maintained by a group of people, it is better to create an organization for your team/project on npm to make it easier for multiple maintainers to manage and publish the package.</p><p>It is also a good practice to have a &quot;prepublish&quot; npm script in the package.json that runs linting and tests before publishing happens. If your code needs to be transpiled first, having a &quot;prepublish&quot; script will make sure this is also done before publishing.</p><p>The use of scoped pacakges is a good practice if you are creating many related packages.</p><p>When creating modules that will be published to an internal registry that is not upstream npm, it is a good practice to scope those modules to the name of your organization. It is also important that you or your company are the owners of the scoped orginization on upstream npm. This is important if a public module which depends on a private module is accidently published to upstream npm, which can lead to the &quot;Dependecy Confusion&quot; hack that is outlined <a href="https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610" target="_blank" rel="noopener noreferrer">in this post</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="publishing-modules"></a>Publishing Modules<a class="hash-link" href="#publishing-modules" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="preparing-code"></a>Preparing Code<a class="hash-link" href="#preparing-code" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="npmignore-or-files"></a><code>.npmignore</code> or <code>files</code><a class="hash-link" href="#npmignore-or-files" title="Direct link to heading">#</a></h4><p>[npm] has default ignore rules and loads from <code>.gitignore</code> but it also offer two methods for you to keep your published packages tidy.</p><ul><li>specifying ignore files in <code>.npmignore</code></li><li>specifying files you only want to publish with <code>files</code> in your <code>package.json</code>.</li></ul><p>Which one to go with is solely up to you and your preference.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="tests-and-docs"></a>Tests and Docs<a class="hash-link" href="#tests-and-docs" title="Direct link to heading">#</a></h4><p>For your tests and any extra documentation, like API reference docs, that goes beyond the packages README, you can choose to publish them or not. For modules that the team publishes we:</p><ul><li>include docs</li><li>exclude tests</li></ul><p>Not including these files can decrease the size of the package that is being installed. If the source code for the package is hosted on github, it is a common practice to use github pages to host any API reference docs and provide a link to those in the README and the package.json.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="transpiling-sources"></a>Transpiling Sources<a class="hash-link" href="#transpiling-sources" title="Direct link to heading">#</a></h4><p>A package written in another language like TypeScript should be published with transpiled JavaScript as the primary executable.</p><p>Generally the original sources should not be required to use your published package, but it&#x27;s your preference whether to publish them or not. Similar to the guidance on tests, the modules that the team publishs that are transpiled only contain the generated code.</p><p>If your module requires build steps, it is recommended to run those before you publish and not when the user installs the package. This is where you would use the <code>prePublish</code> script as mentioned above.</p><p>It is important if you are using Typescript or are generating type definitions for your package, that you make sure to add a reference to the generated type file in your package.json and ensure that the file is included when publishing. For Example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot;: &quot;some_module&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;description&quot;: &quot;A module that does something&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;main&quot;: &quot;./bin/index.js&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;module&quot;: &quot;index.js&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;types&quot;: &quot;types/index.d.ts&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="module-versions"></a>Module Versions<a class="hash-link" href="#module-versions" title="Direct link to heading">#</a></h4><p>It is recommened to use <a href="https://semver.org/" target="_blank" rel="noopener noreferrer">Semantic Versioning</a> when possible. This will make it easier for a user to determine if a new version of a module will potentianlly break their code.</p><p>There are some automation tools that can help with bumping your module to the correct version.</p><ul><li><a href="https://github.com/googleapis/release-please" target="_blank" rel="noopener noreferrer">release-please</a></li><li><a href="https://github.com/conventional-changelog/standard-version" target="_blank" rel="noopener noreferrer">standard-version</a></li></ul><p>Both of those tools will base the version bump on commit messages that follow the <a href="https://www.conventionalcommits.org/en/v1.0.0/" target="_blank" rel="noopener noreferrer">coventional commit standard</a></p><p>The npm cli also provides a <a href="https://docs.npmjs.com/cli/v7/commands/npm-version" target="_blank" rel="noopener noreferrer"><code>version</code> command</a> that can be used to increase the version of package.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="publish-internal-modules"></a>Publish Internal Modules<a class="hash-link" href="#publish-internal-modules" title="Direct link to heading">#</a></h4><p>When publishing to an internal registry, like Artifactory or Nexus, it is recommended to scope your package. This adds extra protection if this module is accidently published to a public registry and avoids the dependecy confusion hack mentioned above.</p><p>How to publish to an internal registry is up to you, but the team recommneds the usage of a <code>.npmrc</code> file.</p><p>A <code>.npmrc</code> file can also be used either per project or globally to change the registry that your package is published to. The contents of this file might look something like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">registry=http://my-internal-registry.local</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you are using the global <code>.npmrc</code> file, you can use the <a href="https://www.npmjs.com/package/npmrc" target="_blank" rel="noopener noreferrer">npmrc module</a> to easily switch between multiple <code>.npmrc</code> configurations, although it is not necessary for publishing to an internal registry.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="learning-resources"></a>Learning Resources<a class="hash-link" href="#learning-resources" title="Direct link to heading">#</a></h2><ul><li><p><a href="https://github.blog/changelog/2020-10-02-npm-automation-tokens/" target="_blank" rel="noopener noreferrer">https://github.blog/changelog/2020-10-02-npm-automation-tokens/</a></p></li><li><p><a href="https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610" target="_blank" rel="noopener noreferrer">https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610</a></p></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/nodeshift/nodejs-reference-architecture/docs/development/npm-publishing.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/nodejs-reference-architecture/development/npm-proxy"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Npm Proxy / Internal Registry</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/nodejs-reference-architecture/development/testing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Testing Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#guidance" class="table-of-contents__link">Guidance</a></li><li><a href="#publishing-modules" class="table-of-contents__link">Publishing Modules</a><ul><li><a href="#preparing-code" class="table-of-contents__link">Preparing Code</a></li></ul></li><li><a href="#learning-resources" class="table-of-contents__link">Learning Resources</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/nodejs-reference-architecture/assets/js/runtime~main.27a4d17c.js"></script>
<script src="/nodejs-reference-architecture/assets/js/main.3a4e6bc3.js"></script>
</body>
</html>